<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>nadako - Haxe 3.1 is here!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.0.0/normalize.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../github.css">
    <link rel="alternate" type="application/atom+xml" title="nadako's rants" href="../atom.xml">
</head>
<body>

<header class="main-header">
    <h1><a href="../index.html" title="Go to the main page">nadako's rants</a></h1>
</header>

 <div class="main">
    <div class="content">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
            <header>
                <h1 itemprop="headline">Haxe 3.1 is here!</h1>
                <section class="post-meta">
                    <time itemprop="datePublished" datetime="2014-03-04">Published on 2014-03-04</time>
                    <span class="tags">#haxe </span>
                </section>
            </header>
            <section itemprop="articleBody">
                <p>The new release of Haxe compiler is finally out to be awesome around the world, thanks to its core developers and contributors (even I helped by bugging people and learning ocaml, yay!).</p>
<p>So, what's new there, apart from tons of bugfixes (especially related to the abstracts feature introduced in 3.0)? Let's see...</p>
<h2>Enum abstracts</h2>
<p>This is something I have written about when it first appeared in Haxe Git repository. Enum abstracts, as the name implies are combination of enums and abstracts and is used to define a finite set of constant values of a given type with proper compile-time checking for exhaustiveness and correctness. You can read more about them in my <a href="./2013-10-21_haxe-enum-abstracts.html">original article</a>, but here's what they look like:</p>
<pre><code class="prettyprint haxe">@:enum abstract State(Int)
{
    var Idle = 0;
    var Walk = 1;
    var Fire = 2;
}</code></pre>
<p>The vars defined here actually become public static inline vars of the <code>State</code> type which is an abstract over <code>Int</code> as written above, you can access them as i.e. <code>State.Idle</code>, or even just <code>Idle</code> if the expression is known to be of that <code>State</code> type, just like Haxe enums, but in run-time they will become plain integers, because of how abstracts work in Haxe.</p>
<h2>Extractors</h2>
<p>Extractors is a nice new pattern matching feature, allowing to apply preprocessing to a value before matching with a pattern in the <code>case</code> expression. The syntax is <code>expr =&gt; pattern</code>, where <code>expr</code> is a custom extractor expression in which the original value being matched is accessed with the <code>_</code> identifier. For example:</p>
<pre><code class="prettyprint haxe">var s = "hello";
switch (s)
{
    case _.toUpperCase() =&gt; "HELLO":
        trace(1);
    case StringTools.urlDecode(_) =&gt; "hello":
        trace(2);
    case "a" + _ =&gt; "ahello":
        trace(3);
}</code></pre>
<p>One thing that extractors help with is working with <code>haxe.macro.Type</code>, as it has <code>Ref&lt;T&gt;</code> objects that needs to be dereferenced before further matching, i.e. matching a <code>String</code> type would now look like this:</p>
<pre><code class="prettyprint haxe">var a = Context.getLocalType();
switch (a)
{
    case TInst(_.get() =&gt; {pack: [], name: "String"}, []):
    case _:
}</code></pre>
<h2>EnumValue.match</h2>
<p>This is a handy little addition helping to check whether given value of an enum matches the required pattern or not, so instead of writing:</p>
<pre><code class="prettyprint haxe">var matches = switch (a) { case A(1): true; default: false; };</code></pre>
<p>You can simply write:</p>
<pre><code class="prettyprint haxe">var matches = a.match(A(1));</code></pre>
<h2>Linking with .NET assemblies directly for C#</h2>
<p>Similar to Flash and Java libraries, you can now directly add .NET libraries to the compiled application when compiling to C#. Haxe compiler now parses the .NET assembly file (i.e. the DLL), extracting and converting types to Haxe. This eliminates the need to write extern declarations for .NET libraries. The command-line option is <code>-net-lib MyLib.dll</code>. Here's a pic related:</p>
<p><img src="images/unity-completion.png" /></p>
<p>In addition to this feature, C# target now supports native .NET attributes, delegates and events. All these changes together should improve Haxe/C# interoperability a lot.</p>
<p>Besides these huge additions, C# target also received much of bug-fixing and other stabilization-related love.</p>
<h2>Generic build</h2>
<p>This is also something I already <a href="./2014-02-25_haxe-genericbuild.html">wrote about</a> recently. This is a new type building facility available through macros and I think this is kind of huge feature and will have many uses (i describe one in my post).</p>
<p>The basic idea is that you can change or even build a completely new type for each <em>instance</em> of a generic (parametrized) type. You specify the build function with <code>@:genericBuild</code> meta, just like with <code>@:build</code>-macros, but instead of returning array of fields for the type being build, the build function returns a whole new type. And the most important is that the <code>@:genericBuild</code>-macro will be executed for each combination of type parameters, so you can modify the type depending on that.</p>
<p>That allows, for example, to re-implement <code>@:generic</code>, as Simon Krajewski <a href="https://gist.github.com/Simn/8ae509cc3824099c1567">has shown</a> in the original pull request, or replace <code>MacroType</code> with a better syntax, or implement a read-only type builder as I did myself. Read my <a href="./2014-02-25_haxe-genericbuild.html">original article</a> for more details.</p>
<h2>ECheckType syntax</h2>
<p>Those who work with macros probably know about <code>ECheckType</code> - the wrapper expression that allows to check whether given expression unifies with given type. However, despite being an expression, there was no actual syntax to write it in your code and you could only generate it with a macro. Now there's a new syntax for that: <code>(expr : MyType)</code>, where <code>expr</code> is any expression and <code>MyType</code> is, well, your type :-) The result of this expression is typed as the given type, so it may be used to type the <code>Dynamic</code> expression, or trigger abstract <code>@:to</code> conversion. For example:</p>
<pre><code class="prettyprint haxe">static function getData():Dynamic return "hello";

static function main()
{
    trace((getData() : String).toLowerCase());
}</code></pre>
<h2>Typed AST</h2>
<p>This is an addition to the Haxe macro API. You can now access the AST after it's fully processed and typed but before actual output generation. The data structure for that is <code>TypedExpr</code> from <code>haxe.macro.Type</code> module that was just a reference in 3.0, now it's a structure similar to <code>haxe.macro.Expr</code> but having type information and making much more sense from a program flow point of view. For example, instead of working with some <em>identifiers</em>, you work with <em>local vars</em>. This has various uses, such as static analysis or custom target generation, as shown by Heinz HÃ¶lzer's <a href="https://github.com/frabbit/hx2python">hx2python</a>.</p>
<h2>Context.getExpectedType</h2>
<p>Talking about macro API, there is also another nice addition: <code>Context.getExpectedType</code> function returns the type of an expression being expected on the macro call site. For example, it returns <code>Int</code> for this macro call: <code>var a:Int = myMacroCall();</code></p>
<h2>So...</h2>
<p>Haxe 3.1 release seems to be more stable than 3.0, considering how many bugs was fixed and the new features are really making the language more expressive. I'd like to give special thanks to <a href="https://github.com/andyli">Andy Li</a> who made Haxe unit test suite up and running on Travis CI thus improving stability of the whole Haxe project.</p>
            </section>
        </article>
        <div id="disqus_thread"></div>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>
    <aside class="sidebar" itemscope itemtype="http://schema.org/Person">
        <article id="about">
            <h2 itemprop="name"><span itemprop="givenName">Dan</span> <span itemprop="familyName">Korostelev</span></h2>
            <section>
                <img src="../photo.jpg" alt="My photo" id="my-photo" itemprop="image" />
                <p itemprop="description">
                    Passionate <span itemprop="jobTitle">programmer</span> from St.Petersburg, Russia.
                    Loves open-source, game development and <a href="http://haxe.org">Haxe</a>!
                </p>
            </section>
        </article>
        <article id="links">
            <h2>Links</h2>
            <section>
                <ul>
                    <li><a title="GitHub" href="https://github.com/nadako"><i class="fa fa-lg fa-github"></i></a></li>
                    <li><a title="LinkedIn" href="https://www.linkedin.com/in/nadako"><i class="fa fa-lg fa-linkedin"></i></a></li>
                    <li><a title="Email" href="mailto:nadako@gmail.com" itemprop="email"><i class="fa fa-lg fa-envelope"></i></a></li>
                    <li><a title="Twitter" href="https://twitter.com/nadako"><i class="fa fa-lg fa-twitter"></i></a></li>
                </ul>
                <p>
                    <a title="Patreon" href="https://patreon.com/nadako">Support me on Patreon!</a>
                </p>
                <p>
                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                        <input type="hidden" name="cmd" value="_s-xclick">
                        <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
                        ">
                        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                        <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
                    </form>
                </p>
            </section>
        </article>
    </aside>
</div>

<footer class="main-footer">
    <p>
        <a href="#">Back to top</a>
    </p>
</footer>

<script>
var disqus_config = function() {
    this.page.url = "http://nadako.github.io/rants/posts/2014-03-04_haxe-31-is-here.html";
    this.page.identifier = "78559625982";
};
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://nadako.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<script src="../highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-75978661-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
