<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>nadako - Вышел Haxe 3.1!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.0.0/normalize.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../github.css">
    <link rel="alternate" type="application/atom+xml" title="nadako's rants" href="../atom.xml">
</head>
<body>

<header class="main-header">
    <h1><a href="../index.html" title="Go to the main page">nadako's rants</a></h1>
</header>

 <div class="main">
    <div class="content">
        <article class="post" lang="ru" itemscope itemtype="http://schema.org/BlogPosting">
            <header>
                <h1 itemprop="headline">Вышел Haxe 3.1!</h1>
                <section class="post-meta">
                    <time itemprop="datePublished" datetime="2014-03-05">Published on 2014-03-05</time>
                    <span class="tags">#haxe </span>
                </section>
            </header>
            <section itemprop="articleBody">
                <p>(This is a translation of my <a href="./2014-03-04_haxe-31-is-here.html">original overview</a> to Russian, as requested by Russian Haxe Community. Это перевод моего <a href="./2014-03-04_haxe-31-is-here.html">оригинального обзора</a> на английский по просьбе русского сообщества Haxe).</p>
<p>Новый релиз компилятора Haxe наконец-то вышел в свет, спасибо разработчикам, контрибьюторам и всем сочувствующим (даже я немного помог, ура-ура!)</p>
<p>Итак, давайте посмотрим, что появилось нового, кроме горы багфиксов (особенно по abstract'ам, введенным в 3.0)...</p>
<h2>Enum abstracts</h2>
<p>Об этой фиче я писал почти сразу как она появилась в гит-репозитории Haxe. Соответствуя своему названию, enum abstract'ы, являются комбинацией enum'ов и abstract'ов и используются для определения набора констант определенного типа, с compile-time поддержкой проверок правильности и полности. Подробнее, вы можете почитать в моем <a href="./2013-10-21_haxe-enum-abstracts.html">оригинальном посте</a> на английском, но выглядят они как-то так:</p>
<pre><code class="prettyprint haxe">@:enum abstract State(Int)
{
    var Idle = 0;
    var Walk = 1;
    var Fire = 2;
}</code></pre>
<p>Переменные, заданные в abstract'е становятся public static inline переменными типа <code>State</code>, который является abstract'ом над <code>Int</code>, как мы указали выше, их можно использовать как <code>State.Idle</code>, или даже просто <code>Idle</code>, если компилятор значет, что выражение должно быть нашего типа <code>State</code>, так же как с enum'ами в Haxe. При этом в run-time, эти значения будут обычными целыми числами, потому что так устроены abstract'ы.</p>
<h2>Extractors</h2>
<p>Экстракторы (extractor) - интересное нововведение для паттерн-матчинга, они позволяют обработать значение перед сопоставлением с шаблоном внутри <code>case</code>-выражения. Синтаксис следующий: <code>expr =&gt; pattern</code>, где <code>expr</code> - произвольное выражение экстрактора, в котором можно использовать оргинальное сопоставляемое значение через идентификатор <code>_</code>. Например:</p>
<pre><code>var s = "hello";
switch (s)
{
    case _.toUpperCase() =&gt; "HELLO":
        trace(1);
    case StringTools.urlDecode(_) =&gt; "hello":
        trace(2);
    case "a" + _ =&gt; "ahello":
        trace(3);
}</code></pre>
<p>Одно из мест, в которых удобно использовать экстракторы - работа с <code>haxe.macro.Type</code>, поскольку эти значения часто имеют объекты-ссылки <code>Ref&lt;T&gt;</code>, которые нужно разыменовать перед дальнейшим сопоставлением, например проверка на то, является ли тип строкой (<code>String</code>) теперь можно записать так:</p>
<pre><code class="prettyprint haxe">var a = Context.getLocalType();
switch (a)
{
    case TInst(_.get() =&gt; {pack: [], name: "String"}, []):
    case _:
}</code></pre>
<h2>EnumValue.match</h2>
<p>Это небольшое, но полезное дополнение к enum'ам, позволяющее проверять, соотвествует ли указанное значение enum шаблону. Теперь, вместо такого:</p>
<pre><code class="prettyprint haxe">var matches = switch (a) { case A(1): true; default: false; };</code></pre>
<p>Можно просто писать:</p>
<pre><code class="prettyprint haxe">var matches = a.match(A(1));</code></pre>
<h2>Подключение .NET библиотек напрямую для C#</h2>
<p>Теперь вы можете напрямую подключать .NET-библиотеки при компиляции в C#-таргет, так же как это уже делается для Flash и Java. Компилятор парсит файл .NET assembly (DLL-ку), вытаскивая из неё и конвертируя типы в Haxe. Это избавляет от необходимости писать extern-объявления для .NET-библиотек. Делается это через аргумент командной строки <code>-net-lib MyLib.dll</code>. Вот картинка для привлечения внимания:</p>
<p><img src="images/unity-completion.png" /></p>
<p>В дополнение к этой фиче, C#-таргет теперь поддерживает аттрибуты, делегаты и события .NET, а все это нововведения вместе взятые должны сильно улучшить возможности взаимодействия Haxe и C#.</p>
<p>Кроме этих мощнейших нововведений, C#-таргет получил большую долю любви, связанной с тестированием, исправления багов и общей стабилизации.</p>
<h2>Generic build</h2>
<p>Об этом я так же недавно <a href="./2014-02-25_haxe-genericbuild.html">уже писал</a>. Это новое средство генерации типов через макросы и лично я думаю, что это очень большая фича и что она найдет множество применений (в статье я описываю одно, которое я уже нашел).</p>
<p>Основная идея в том, что вы можете изменить или даже построить новый тип для каждого <em>экземпляра (специфицкации)</em> шаблонного (параметризованного) типа. Вы указываете функцию построения с помощью меты <code>@:genericBuild</code>, так же как с <code>@:build</code>-макросами, но вместо возвращения списка полей для строящегося типа, build-функция возвращает целый тип. И самое главное то, что макрос <code>@:genericBuild</code> будет выполнен для каждой комбинации параметров типа, поэтому вы можете генерировать тип на основе указанных параметров.</p>
<p>Например, это позволяет реализовать <code>@:generic</code> через макросы, как <a href="https://gist.github.com/Simn/8ae509cc3824099c1567">показал</a> в оригинальном пулл-реквесте Simon Krajewski, или заменить <code>MacroType</code> гораздо более красивым синтаксисом, или реализовать константные (read-only) типы, как делаю я. Для подробностей, читайте мой <a href="./2014-02-25_haxe-genericbuild.html">оригинальный пост</a>.</p>
<h2>Синтаксис для ECheckType</h2>
<p>Те, кто работают с макросами вероятно знают про <code>ECheckType</code> - выражение-обертка, позволяющее проверить, подходит ли данное выражение под указанный тип. Однако, несмотря на то что это выражение, в Haxe не было синтаксиса для него, и его можно было сгенерировать только через макрс. Теперь, для этого появился новый синтаксис: <code>(expr : MyType)</code>, где <code>expr</code> - любое выражение, а <code>MyType</code> - указанный тип. Результат такого выражения будет указанного типа, поэтому его можно использовать для типизации <code>Dynamic</code> или конвертации abtract'ов через <code>@:to</code>. Например:</p>
<pre><code class="prettyprint haxe">static function getData():Dynamic return "hello";

static function main()
{
    trace((getData() : String).toLowerCase());
}</code></pre>
<h2>Типизированное AST</h2>
<p>Это дополнение API макросов Haxe. Теперь появился доступ к синтаксическому дереву (AST) после того как оно полностью обработано и типизировано, но до непосредственного вывода сгенерированного (байт)кода. Структура данных для этого -  <code>TypedExpr</code> из модуля <code>haxe.macro.Type</code>, который был просто ссылкой 3.0, теперь это структура, похожая на <code>haxe.macro.Expr</code>, но содержащая информацию о типе выражения и имеющая больше смысла с точки зрения структуры программы. Например, вместо работы с <em>идентификаторами</em>, вы работаете с <em>локальными переменными</em> и <em>полями</em>. Это имеет множество применений, например в статическом анализе или генерации новых таргетов, как показал нам Heinz Hölzer в своем проекте <a href="https://github.com/frabbit/hx2python">hx2python</a>.</p>
<h2>Context.getExpectedType</h2>
<p>Продолжая тему API макросов, замечу еще одно небольшое дополнение: <code>Context.getExpectedType</code> - функция, возвращающая тип выражения, ожидаемый в месте вызова макроса. Например, она возвращает <code>Int</code> для вот такого вызова макроса: <code>var a:Int = myMacroCall();</code></p>
<h2>Итак...</h2>
<p>Релиз Haxe 3.1 выглядит более стабильным чем 3.0, принимая во внимание колиество исправленных багов, а новые фичи безусловно делают язык более выразительным. Хотелось бы выразить особую благодарность <a href="https://github.com/andyli">Andy Li</a>, который настроил запуск юнит-тестов Haxe на Travis CI, тем самым обеспечив стабильность всему проекту Haxe.</p>
            </section>
        </article>
        <div id="disqus_thread"></div>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>
    <aside class="sidebar" itemscope itemtype="http://schema.org/Person">
        <article id="about">
            <h2 itemprop="name"><span itemprop="givenName">Dan</span> <span itemprop="familyName">Korostelev</span></h2>
            <section>
                <img src="../photo.jpg" alt="My photo" id="my-photo" itemprop="image" />
                <p itemprop="description">
                    Passionate <span itemprop="jobTitle">programmer</span> from St.Petersburg, Russia.
                    Loves open-source, game development and <a href="http://haxe.org">Haxe</a>!
                </p>
            </section>
        </article>
        <article id="links">
            <h2>Links</h2>
            <section>
                <ul>
                    <li><a title="GitHub" href="https://github.com/nadako"><i class="fa fa-lg fa-github"></i></a></li>
                    <li><a title="LinkedIn" href="https://www.linkedin.com/in/nadako"><i class="fa fa-lg fa-linkedin"></i></a></li>
                    <li><a title="Email" href="mailto:nadako@gmail.com" itemprop="email"><i class="fa fa-lg fa-envelope"></i></a></li>
                    <li><a title="Twitter" href="https://twitter.com/nadako"><i class="fa fa-lg fa-twitter"></i></a></li>
                </ul>
                <p>
                    <a title="Patreon" href="https://patreon.com/nadako">Support me on Patreon!</a>
                </p>
                <p>
                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                        <input type="hidden" name="cmd" value="_s-xclick">
                        <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
                        ">
                        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                        <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
                    </form>
                </p>
            </section>
        </article>
    </aside>
</div>

<footer class="main-footer">
    <p>
        <a href="#">Back to top</a>
    </p>
</footer>

<script>
var disqus_config = function() {
    this.page.url = "http://nadako.github.io/rants/posts/2014-03-05_haxe-31-is-here-russian.html";
    this.page.identifier = "78645101794";
};
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://nadako.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<script src="../highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-75978661-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
